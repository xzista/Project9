# Онлайн платформа торговой сети электроники

---

## Стек технологий

* Python **3.8+**
* Django **3+**
* Django REST Framework **3.10+**
* PostgreSQL **10+**
* django-filter

---

## Функциональность

### Модель сети

Сеть представляет собой иерархическую структуру из трёх уровней:

* **0 уровень** — завод
* **1 уровень** — розничная сеть
* **2 уровень** — индивидуальный предприниматель

Уровень звена определяется **отношением к другим объектам**, а не названием.

Каждое звено сети содержит:

* название;
* контактные данные (email, страна, город, улица, дом);
* одного поставщика (другое звено сети или `null` для завода);
* задолженность перед поставщиком (Decimal, до копеек);
* список продуктов;
* дату и время создания (автоматически);
* автоматически вычисляемый уровень иерархии.

### Продукты

Продукт привязывается к конкретному звену сети и содержит:

* название;
* модель;
* дату выхода на рынок.

---

## Админ‑панель

В админ‑панели Django реализовано:

* просмотр и редактирование звеньев сети;
* отображение уровня иерархии;
* ссылка на поставщика прямо со страницы объекта;
* фильтр по городу;
* admin‑action для **очистки задолженности** у выбранных объектов;
* управление продуктами.

Админка доступна по адресу:

```
/admin/
```

---

## API

API реализовано с использованием Django REST Framework.

### Возможности API

* CRUD для звеньев сети;
* CRUD для продуктов;
* фильтрация звеньев по стране;
* поиск по названию и городу;
* сортировка по дате создания, уровню и имени;
* запрет обновления поля задолженности (`debt`) через API.

### Эндпоинты

```
/api/nodes/       # звенья сети
/api/products/    # продукты
```

Примеры:

```
GET /api/nodes/?country=Russia
GET /api/nodes/?search=Москва
```

---

## Права доступа

Доступ к API разрешён **только активным сотрудникам**.

Используется стандартная модель пользователя Django.

Требования к пользователю:

* `is_authenticated = True`
* `is_active = True`
* `is_staff = True`

Для проверки используется **Basic Auth** или **Session Auth**.

В ТЗ не было явного указание на использование JWT, поэтому использовались стандартные механизмы Django, они проще для проверки работы прав доступа.

При необходимости можно реализовать и JWT.

---

## Авторизация и проверка API

### Через Postman (Basic Auth)

1. Authorization → **Basic Auth**
2. Указать логин и пароль пользователя
3. Выполнить запрос к API

Пример:

```
GET http://127.0.0.1:8000/api/nodes/
```

---

## Установка и запуск проекта

### 1. Клонирование репозитория

```bash
git clone https://github.com/xzista/Project9
cd project
```

### 2. Установка зависимостей с использованием Poetry

```bash
poetry install
```

### 3. Настройка базы данных

В `.env` указать параметры для PostgreSQL по примеру .env.sample:

### 4. Миграции

```bash
python manage.py makemigrations
python manage.py migrate
```

### 5. Запуск сервера

```bash
python manage.py runserver
```

---

## Заполнение тестовыми данными

### Создание пользователей

Команда создаёт несколько пользователей с разными правами доступа:

```bash
python manage.py seed_users
```

Создаются пользователи:

| Пользователь      | Пароль      | is_staff | is_active | Доступ к API |
| ----------------- | ----------- | -------- | --------- | ------------ |
| admin             | admin123    | ✅        | ✅         | ✅            |
| employee          | employee123 | ✅        | ✅         | ✅            |
| inactive_employee | inactive123 | ✅        | ❌         | ❌            |
| regular_user      | user123     | ❌        | ✅         | ❌            |

---

### Заполнение сети и продуктов

```bash
python manage.py seed_store
```

Команда создаёт:

* завод (уровень 0) Москва - Россия;
* завод (уровень 0) New-York - USA;
* розничную сеть (уровень 1);
* индивидуального предпринимателя (уровень 2);
* связанные продукты.

---

## Примечания по архитектуре

* Уровень иерархии вычисляется автоматически на основе цепочки поставщиков.
* Защита от циклических ссылок реализована при вычислении уровня.
* Обновление задолженности возможно только через админ‑панель.
* JWT не используется намеренно, так как не требуется в рамках задания и усложняет проверку.

---

## Возможные улучшения

* Добавление JWT‑аутентификации;
* Покрытие проекта автотестами;
* Docker‑окружение;
* Разделение ролей сотрудников.
